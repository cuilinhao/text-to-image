<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>API Key å®‰å…¨æµ‹è¯•</title>
    <style>
        body {
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
            font-family: Arial, sans-serif;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 6px;
            background-color: #f9f9f9;
        }
        .security-check {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .pass {
            background-color: #f6ffed;
            border: 1px solid #b7eb8f;
            color: #52c41a;
        }
        .fail {
            background-color: #fff2f0;
            border: 1px solid #ffccc7;
            color: #ff4d4f;
        }
        .warning {
            background-color: #fffbe6;
            border: 1px solid #ffe58f;
            color: #fa8c16;
        }
        button {
            padding: 10px 20px;
            background-color: #1890ff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #40a9ff;
        }
        input[type="password"] {
            width: 300px;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin: 5px;
        }
        .code-block {
            background-color: #f5f5f5;
            border: 1px solid #d9d9d9;
            border-radius: 4px;
            padding: 10px;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 12px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>ğŸ” API Key å®‰å…¨æ€§æµ‹è¯•</h1>
    
    <div class="test-section">
        <h3>ğŸ“‹ å®‰å…¨æ£€æŸ¥é¡¹ç›®</h3>
        <p>æ­¤é¡µé¢ç”¨äºéªŒè¯é¡¹ç›®ä¸­API Keyçš„å®‰å…¨å¤„ç†æ˜¯å¦æ­£ç¡®ã€‚</p>
        
        <div id="hardcodedCheck" class="security-check">
            <strong>ğŸ” æ£€æŸ¥1: ç¡¬ç¼–ç API Keyæ£€æŸ¥</strong>
            <div id="hardcodedResult">æ£€æŸ¥ä¸­...</div>
        </div>
        
        <div id="storageCheck" class="security-check">
            <strong>ğŸ” æ£€æŸ¥2: æœ¬åœ°å­˜å‚¨å®‰å…¨æ€§</strong>
            <div id="storageResult">æ£€æŸ¥ä¸­...</div>
        </div>
        
        <div id="transmissionCheck" class="security-check">
            <strong>ğŸ” æ£€æŸ¥3: ä¼ è¾“å®‰å…¨æ€§</strong>
            <div id="transmissionResult">æ£€æŸ¥ä¸­...</div>
        </div>
        
        <div id="visibilityCheck" class="security-check">
            <strong>ğŸ” æ£€æŸ¥4: ç•Œé¢æ˜¾ç¤ºå®‰å…¨æ€§</strong>
            <div id="visibilityResult">æ£€æŸ¥ä¸­...</div>
        </div>
    </div>
    
    <div class="test-section">
        <h3>ğŸ§ª API Key å­˜å‚¨æµ‹è¯•</h3>
        <div>
            <label>æµ‹è¯•API Key:</label>
            <input type="password" id="testApiKey" placeholder="è¾“å…¥æµ‹è¯•API Key">
            <button onclick="testApiKeyStorage()">æµ‹è¯•å­˜å‚¨</button>
            <button onclick="clearTestStorage()">æ¸…é™¤å­˜å‚¨</button>
        </div>
        <div id="storageTestResult"></div>
    </div>
    
    <div class="test-section">
        <h3>ğŸ“Š å®‰å…¨å»ºè®®</h3>
        <div class="code-block">
âœ… å·²å®ç°çš„å®‰å…¨æªæ–½ï¼š
â€¢ API Key ä½¿ç”¨ password ç±»å‹è¾“å…¥æ¡†éšè—æ˜¾ç¤º
â€¢ ä½¿ç”¨ localStorage è¿›è¡Œæœ¬åœ°å­˜å‚¨ï¼Œä¸ä¸Šä¼ æœåŠ¡å™¨
â€¢ æä¾›æ¸…é™¤ API Key çš„åŠŸèƒ½
â€¢ åœ¨ç•Œé¢ä¸­æ˜¾ç¤ºå®‰å…¨æé†’
â€¢ è°ƒè¯•æ—¥å¿—ä¸­å¯¹ API Key è¿›è¡Œè„±æ•å¤„ç†

ğŸ”’ æ¨èçš„é¢å¤–å®‰å…¨æªæ–½ï¼š
â€¢ ä½¿ç”¨æ— ç—•æ¨¡å¼æµè§ˆå™¨è¿›è¡Œæ•æ„Ÿæ“ä½œ
â€¢ å®šæœŸæ¸…é™¤æµè§ˆå™¨æ•°æ®
â€¢ ä¸ºæ­¤å·¥å…·åˆ›å»ºä¸“é—¨çš„ API Key å¹¶è®¾ç½®ä½¿ç”¨é™é¢
â€¢ ä¸åœ¨å…¬å…±ç½‘ç»œç¯å¢ƒä¸‹ä½¿ç”¨
â€¢ å®šæœŸæ£€æŸ¥ API ä½¿ç”¨æƒ…å†µå’Œè´¦å•
        </div>
    </div>
    
    <script>
        // æ£€æŸ¥ç¡¬ç¼–ç API Key
        function checkHardcodedApiKeys() {
            const result = document.getElementById('hardcodedResult');
            
            // æ£€æŸ¥é¡µé¢æºç ä¸­æ˜¯å¦åŒ…å«API Keyæ¨¡å¼
            const pageSource = document.documentElement.outerHTML;
            const apiKeyPattern = /sk-[A-Za-z0-9]{48}/g;
            const matches = pageSource.match(apiKeyPattern);
            
            if (matches && matches.length > 0) {
                result.innerHTML = `âŒ å‘ç° ${matches.length} ä¸ªç¡¬ç¼–ç çš„API Key: ${matches.join(', ')}`;
                result.parentElement.className = 'security-check fail';
            } else {
                result.innerHTML = 'âœ… æœªå‘ç°ç¡¬ç¼–ç çš„API Key';
                result.parentElement.className = 'security-check pass';
            }
        }
        
        // æ£€æŸ¥æœ¬åœ°å­˜å‚¨å®‰å…¨æ€§
        function checkLocalStorage() {
            const result = document.getElementById('storageResult');
            
            try {
                // æµ‹è¯•localStorageæ˜¯å¦å¯ç”¨
                localStorage.setItem('test', 'test');
                localStorage.removeItem('test');
                
                // æ£€æŸ¥æ˜¯å¦æœ‰API Keyç›¸å…³çš„å­˜å‚¨
                const keys = Object.keys(localStorage).filter(key => 
                    key.toLowerCase().includes('api') || key.toLowerCase().includes('key')
                );
                
                if (keys.length > 0) {
                    result.innerHTML = `âš ï¸ å‘ç° ${keys.length} ä¸ªAPIç›¸å…³çš„æœ¬åœ°å­˜å‚¨é¡¹: ${keys.join(', ')}`;
                    result.parentElement.className = 'security-check warning';
                } else {
                    result.innerHTML = 'âœ… æœ¬åœ°å­˜å‚¨å®‰å…¨ï¼Œæœªå‘ç°æ•æ„Ÿæ•°æ®';
                    result.parentElement.className = 'security-check pass';
                }
            } catch (error) {
                result.innerHTML = `âŒ æœ¬åœ°å­˜å‚¨æ£€æŸ¥å¤±è´¥: ${error.message}`;
                result.parentElement.className = 'security-check fail';
            }
        }
        
        // æ£€æŸ¥ä¼ è¾“å®‰å…¨æ€§
        function checkTransmissionSecurity() {
            const result = document.getElementById('transmissionResult');
            
            // æ£€æŸ¥æ˜¯å¦ä½¿ç”¨HTTPS
            if (location.protocol === 'https:') {
                result.innerHTML = 'âœ… ä½¿ç”¨HTTPSåè®®ï¼Œä¼ è¾“åŠ å¯†';
                result.parentElement.className = 'security-check pass';
            } else if (location.hostname === 'localhost' || location.hostname === '127.0.0.1') {
                result.innerHTML = 'âš ï¸ æœ¬åœ°å¼€å‘ç¯å¢ƒï¼Œå»ºè®®ç”Ÿäº§ç¯å¢ƒä½¿ç”¨HTTPS';
                result.parentElement.className = 'security-check warning';
            } else {
                result.innerHTML = 'âŒ æœªä½¿ç”¨HTTPSï¼Œä¼ è¾“ä¸å®‰å…¨';
                result.parentElement.className = 'security-check fail';
            }
        }
        
        // æ£€æŸ¥ç•Œé¢æ˜¾ç¤ºå®‰å…¨æ€§
        function checkVisibilitySecurity() {
            const result = document.getElementById('visibilityResult');
            
            // æ£€æŸ¥æ˜¯å¦æœ‰passwordç±»å‹çš„è¾“å…¥æ¡†
            const passwordInputs = document.querySelectorAll('input[type="password"]');
            
            if (passwordInputs.length > 0) {
                result.innerHTML = `âœ… å‘ç° ${passwordInputs.length} ä¸ªå¯†ç è¾“å…¥æ¡†ï¼ŒAPI Keyå·²éšè—æ˜¾ç¤º`;
                result.parentElement.className = 'security-check pass';
            } else {
                result.innerHTML = 'âŒ æœªå‘ç°å¯†ç è¾“å…¥æ¡†ï¼ŒAPI Keyå¯èƒ½æ˜æ–‡æ˜¾ç¤º';
                result.parentElement.className = 'security-check fail';
            }
        }
        
        // æµ‹è¯•API Keyå­˜å‚¨
        function testApiKeyStorage() {
            const testKey = document.getElementById('testApiKey').value;
            const resultDiv = document.getElementById('storageTestResult');
            
            if (!testKey) {
                resultDiv.innerHTML = '<div class="security-check fail">âŒ è¯·è¾“å…¥æµ‹è¯•API Key</div>';
                return;
            }
            
            try {
                // å­˜å‚¨æµ‹è¯•
                localStorage.setItem('testApiKey', testKey);
                
                // è¯»å–æµ‹è¯•
                const storedKey = localStorage.getItem('testApiKey');
                
                if (storedKey === testKey) {
                    resultDiv.innerHTML = `
                        <div class="security-check pass">
                            âœ… API Keyå­˜å‚¨æµ‹è¯•æˆåŠŸ<br>
                            â€¢ å­˜å‚¨é•¿åº¦: ${testKey.length} å­—ç¬¦<br>
                            â€¢ å­˜å‚¨ä½ç½®: localStorage<br>
                            â€¢ è¯»å–æ­£ç¡®: ${storedKey === testKey ? 'æ˜¯' : 'å¦'}
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = '<div class="security-check fail">âŒ API Keyå­˜å‚¨æµ‹è¯•å¤±è´¥ï¼Œè¯»å–æ•°æ®ä¸åŒ¹é…</div>';
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="security-check fail">âŒ API Keyå­˜å‚¨æµ‹è¯•å¤±è´¥: ${error.message}</div>`;
            }
        }
        
        // æ¸…é™¤æµ‹è¯•å­˜å‚¨
        function clearTestStorage() {
            try {
                localStorage.removeItem('testApiKey');
                document.getElementById('testApiKey').value = '';
                document.getElementById('storageTestResult').innerHTML = '<div class="security-check pass">âœ… æµ‹è¯•å­˜å‚¨å·²æ¸…é™¤</div>';
            } catch (error) {
                document.getElementById('storageTestResult').innerHTML = `<div class="security-check fail">âŒ æ¸…é™¤å¤±è´¥: ${error.message}</div>`;
            }
        }
        
        // é¡µé¢åŠ è½½æ—¶è¿è¡Œæ‰€æœ‰æ£€æŸ¥
        window.onload = function() {
            setTimeout(() => {
                checkHardcodedApiKeys();
                checkLocalStorage();
                checkTransmissionSecurity();
                checkVisibilitySecurity();
            }, 500);
        };
    </script>
</body>
</html>