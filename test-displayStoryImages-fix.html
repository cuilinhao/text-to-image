<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>æµ‹è¯• displayStoryImages ä¿®å¤</title>
    <style>
        body {
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
            font-family: Arial, sans-serif;
        }
        .test-result {
            padding: 15px;
            margin: 10px 0;
            border-radius: 6px;
        }
        .success {
            background-color: #f6ffed;
            border: 1px solid #b7eb8f;
            color: #52c41a;
        }
        .error {
            background-color: #fff2f0;
            border: 1px solid #ffccc7;
            color: #ff4d4f;
        }
        .info {
            background-color: #e6f7ff;
            border: 1px solid #91d5ff;
            color: #1890ff;
        }
        button {
            padding: 10px 20px;
            background-color: #1890ff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #40a9ff;
        }
        #result {
            margin-top: 20px;
            padding: 15px;
            border: 1px solid #d9d9d9;
            border-radius: 6px;
            background-color: #fafafa;
        }
    </style>
</head>
<body>
    <h1>ğŸ”§ displayStoryImages å‡½æ•°ä¿®å¤æµ‹è¯•</h1>
    
    <div class="test-result info">
        <h3>ğŸ“‹ æµ‹è¯•è¯´æ˜</h3>
        <p>è¿™ä¸ªé¡µé¢ç”¨äºæµ‹è¯• <code>displayStoryImages</code> å‡½æ•°æ˜¯å¦å·²ç»æ­£ç¡®ä¿®å¤ã€‚</p>
        <p>åŸå§‹é”™è¯¯ï¼š<code>displayStoryImages is not defined</code></p>
    </div>
    
    <div class="test-result">
        <h3>ğŸ§ª æµ‹è¯•æ­¥éª¤</h3>
        <button onclick="testDisplayStoryImagesExists()">1. æµ‹è¯•å‡½æ•°æ˜¯å¦å­˜åœ¨</button>
        <button onclick="testDisplayStoryImagesCall()">2. æµ‹è¯•å‡½æ•°è°ƒç”¨</button>
        <button onclick="testWithMockData()">3. æµ‹è¯•æ¨¡æ‹Ÿæ•°æ®æ˜¾ç¤º</button>
        <button onclick="runAllTests()">ğŸš€ è¿è¡Œæ‰€æœ‰æµ‹è¯•</button>
    </div>
    
    <div id="result"></div>
    
    <script>
        // æ¨¡æ‹Ÿæ•…äº‹å›¾ç‰‡æ•°æ®
        let storyGeneratedImages = [];
        
        // æµ‹è¯•1: æ£€æŸ¥å‡½æ•°æ˜¯å¦å­˜åœ¨
        function testDisplayStoryImagesExists() {
            const result = document.getElementById('result');
            
            if (typeof displayStoryImages === 'function') {
                result.innerHTML = `
                    <div class="test-result success">
                        <h4>âœ… æµ‹è¯•1é€šè¿‡</h4>
                        <p><code>displayStoryImages</code> å‡½æ•°å·²æ­£ç¡®å®šä¹‰</p>
                    </div>
                `;
            } else {
                result.innerHTML = `
                    <div class="test-result error">
                        <h4>âŒ æµ‹è¯•1å¤±è´¥</h4>
                        <p><code>displayStoryImages</code> å‡½æ•°æœªå®šä¹‰</p>
                        <p>è¯·æ£€æŸ¥ä¸»é¡µé¢ sora_image.html ä¸­æ˜¯å¦åŒ…å«äº†å‡½æ•°å®šä¹‰</p>
                    </div>
                `;
            }
        }
        
        // æµ‹è¯•2: æµ‹è¯•å‡½æ•°è°ƒç”¨
        function testDisplayStoryImagesCall() {
            const result = document.getElementById('result');
            
            try {
                // æ¸…ç©ºæ•°æ®æµ‹è¯•
                storyGeneratedImages = [];
                displayStoryImages();
                
                result.innerHTML = `
                    <div class="test-result success">
                        <h4>âœ… æµ‹è¯•2é€šè¿‡</h4>
                        <p><code>displayStoryImages()</code> å‡½æ•°å¯ä»¥æ­£å¸¸è°ƒç”¨ï¼ˆç©ºæ•°æ®ï¼‰</p>
                    </div>
                `;
            } catch (error) {
                result.innerHTML = `
                    <div class="test-result error">
                        <h4>âŒ æµ‹è¯•2å¤±è´¥</h4>
                        <p>å‡½æ•°è°ƒç”¨å‡ºé”™: ${error.message}</p>
                        <p>é”™è¯¯è¯¦æƒ…: ${error.stack}</p>
                    </div>
                `;
            }
        }
        
        // æµ‹è¯•3: æµ‹è¯•æ¨¡æ‹Ÿæ•°æ®æ˜¾ç¤º
        function testWithMockData() {
            const result = document.getElementById('result');
            
            try {
                // åˆ›å»ºæ¨¡æ‹Ÿæ•°æ®
                storyGeneratedImages = [
                    {
                        url: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZGRkIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxNCIgZmlsbD0iIzk5OSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPuaXoOWbvuWDjzwvdGV4dD48L3N2Zz4=',
                        prompt: 'æµ‹è¯•æç¤ºè¯1ï¼šä¸€ä¸ªç¾ä¸½çš„é£æ™¯',
                        sceneIndex: 1,
                        sceneTitle: 'å¼€åœº',
                        platform: 'APICore'
                    },
                    {
                        url: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZjBmMGYwIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxNCIgZmlsbD0iIzY2NiIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPuaXoOWbvuWDjzI8L3RleHQ+PC9zdmc+',
                        prompt: 'æµ‹è¯•æç¤ºè¯2ï¼šè§’è‰²ç™»åœº',
                        sceneIndex: 2,
                        sceneTitle: 'è§’è‰²ä»‹ç»',
                        platform: 'äº‘é›¾API'
                    }
                ];
                
                displayStoryImages();
                
                result.innerHTML = `
                    <div class="test-result success">
                        <h4>âœ… æµ‹è¯•3é€šè¿‡</h4>
                        <p><code>displayStoryImages()</code> å‡½æ•°å¯ä»¥æ­£å¸¸æ˜¾ç¤ºæ¨¡æ‹Ÿæ•°æ®</p>
                        <p>å·²ç”Ÿæˆ ${storyGeneratedImages.length} å¼ æµ‹è¯•å›¾ç‰‡çš„æ˜¾ç¤ºç•Œé¢</p>
                    </div>
                `;
            } catch (error) {
                result.innerHTML = `
                    <div class="test-result error">
                        <h4>âŒ æµ‹è¯•3å¤±è´¥</h4>
                        <p>æ¨¡æ‹Ÿæ•°æ®æ˜¾ç¤ºå‡ºé”™: ${error.message}</p>
                        <p>é”™è¯¯è¯¦æƒ…: ${error.stack}</p>
                    </div>
                `;
            }
        }
        
        // è¿è¡Œæ‰€æœ‰æµ‹è¯•
        function runAllTests() {
            const result = document.getElementById('result');
            result.innerHTML = '<div class="test-result info"><h4>ğŸ”„ æ­£åœ¨è¿è¡Œæ‰€æœ‰æµ‹è¯•...</h4></div>';
            
            setTimeout(() => {
                let allPassed = true;
                let testResults = [];
                
                // æµ‹è¯•1
                if (typeof displayStoryImages === 'function') {
                    testResults.push('âœ… æµ‹è¯•1: å‡½æ•°å­˜åœ¨æ£€æŸ¥ - é€šè¿‡');
                } else {
                    testResults.push('âŒ æµ‹è¯•1: å‡½æ•°å­˜åœ¨æ£€æŸ¥ - å¤±è´¥');
                    allPassed = false;
                }
                
                // æµ‹è¯•2
                try {
                    storyGeneratedImages = [];
                    displayStoryImages();
                    testResults.push('âœ… æµ‹è¯•2: ç©ºæ•°æ®è°ƒç”¨ - é€šè¿‡');
                } catch (error) {
                    testResults.push(`âŒ æµ‹è¯•2: ç©ºæ•°æ®è°ƒç”¨ - å¤±è´¥ (${error.message})`);
                    allPassed = false;
                }
                
                // æµ‹è¯•3
                try {
                    storyGeneratedImages = [
                        {
                            url: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZGRkIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxNCIgZmlsbD0iIzk5OSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPuaXoOWbvuWDjzwvdGV4dD48L3N2Zz4=',
                            prompt: 'æµ‹è¯•æç¤ºè¯',
                            sceneIndex: 1,
                            platform: 'APICore'
                        }
                    ];
                    displayStoryImages();
                    testResults.push('âœ… æµ‹è¯•3: æ¨¡æ‹Ÿæ•°æ®æ˜¾ç¤º - é€šè¿‡');
                } catch (error) {
                    testResults.push(`âŒ æµ‹è¯•3: æ¨¡æ‹Ÿæ•°æ®æ˜¾ç¤º - å¤±è´¥ (${error.message})`);
                    allPassed = false;
                }
                
                const resultClass = allPassed ? 'success' : 'error';
                const resultIcon = allPassed ? 'ğŸ‰' : 'âš ï¸';
                const resultTitle = allPassed ? 'æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼' : 'éƒ¨åˆ†æµ‹è¯•å¤±è´¥';
                
                result.innerHTML = `
                    <div class="test-result ${resultClass}">
                        <h4>${resultIcon} ${resultTitle}</h4>
                        <ul>
                            ${testResults.map(test => `<li>${test}</li>`).join('')}
                        </ul>
                        ${allPassed ? 
                            '<p><strong>âœ… displayStoryImages å‡½æ•°ä¿®å¤æˆåŠŸï¼</strong></p>' : 
                            '<p><strong>âŒ ä»æœ‰é—®é¢˜éœ€è¦è§£å†³ï¼Œè¯·æ£€æŸ¥ä¸»é¡µé¢ä»£ç ã€‚</strong></p>'
                        }
                    </div>
                `;
            }, 500);
        }
        
        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è¿è¡ŒåŸºç¡€æµ‹è¯•
        window.onload = function() {
            testDisplayStoryImagesExists();
        };
        
        // ä»ä¸»é¡µé¢å¯¼å…¥å‡½æ•°ï¼ˆå¦‚æœå¯ç”¨ï¼‰
        try {
            // å°è¯•ä»çˆ¶çª—å£æˆ–ä¸»é¡µé¢è·å–å‡½æ•°
            if (window.parent && window.parent.displayStoryImages) {
                window.displayStoryImages = window.parent.displayStoryImages;
            }
        } catch (e) {
            console.log('æ— æ³•ä»çˆ¶çª—å£è·å–å‡½æ•°ï¼Œå°†æµ‹è¯•æœ¬åœ°å®šä¹‰');
        }
        
        // ä¸´æ—¶å®šä¹‰å‡½æ•°ç”¨äºæµ‹è¯•ï¼ˆå¦‚æœä¸»é¡µé¢çš„å‡½æ•°ä¸å¯ç”¨ï¼‰
        if (typeof displayStoryImages === 'undefined') {
            window.displayStoryImages = function() {
                const result = document.getElementById('result');
                if (!result) return;
                
                if (storyGeneratedImages.length === 0) {
                    // åœ¨æµ‹è¯•é¡µé¢ä¸­æ˜¾ç¤ºç»“æœ
                    const testResult = document.createElement('div');
                    testResult.innerHTML = '<h3>æš‚æ— ç”Ÿæˆçš„æ•…äº‹å›¾ç‰‡</h3>';
                    return;
                }
                
                // ç®€å•çš„æ˜¾ç¤ºé€»è¾‘ç”¨äºæµ‹è¯•
                const testResult = document.createElement('div');
                testResult.innerHTML = `
                    <h3>æ•…äº‹åˆ†é•œç”Ÿæˆç»“æœ (å…± ${storyGeneratedImages.length} å¼ å›¾ç‰‡)ï¼š</h3>
                    ${storyGeneratedImages.map((img, index) => `
                        <div style="border: 1px solid #ddd; padding: 10px; margin: 10px 0;">
                            <img src="${img.url}" alt="Story Image ${index + 1}" style="max-width: 200px;">
                            <p><strong>åˆ†é•œ ${img.sceneIndex}:</strong> ${img.prompt}</p>
                            <p><strong>å¹³å°:</strong> ${img.platform}</p>
                        </div>
                    `).join('')}
                `;
            };
        }
    </script>
</body>
</html>